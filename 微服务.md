# 微服务

## 限流

https://zhuanlan.zhihu.com/p/338368004

#### 方案

+ 计数限流

+ 固定窗口限流

+ 滑动窗口限流

+ 漏桶算法

+ 令牌桶算法

#### 分布式限流

## 降级

内部暂时舍弃对一些非核心的接口和数据的请求，而直接返回一个提前准备好的fallback（退路）错误处理信息

## 熔断

+ 关闭

+ 打开

+ 半打开

## 负载均衡

## 高并发系统搭建

#### 目标

##### 高性能

+ 平均值

+ 最大值

+ 分位值

##### 高可用

+ 平均故障间隔

+ 平均故障恢复时间

##### 可扩展

#### 实现

##### mysql

+ 读写分离

+ 按业务分库

+ 大表拆小表

##### redis

+ redis作mysql缓存

##### mq

+ 加入mq削峰填谷，异步消费

##### 负载均衡

+ 使用nginx负载均衡

+ 使用LVS或F5使nginx负载均衡

+ DNS轮询

##### 流量控制算法

+ 固定窗口

+ 滑动窗口

+ 漏桶

+ 令牌桶

##### 采用搜索引擎和nosql数据库替代mysql

+ redis

+ mongodb

+ es

##### 微服务

+ 大应用拆分为小应用

+ 微服务复用

+ 使用k8s动态部署

+ 使用云平台承载服务

#### 演化

[服务端高并发分布式架构演进之路](https://segmentfault.com/a/1190000018626163)



## Rpc


#### Rpc简介

##### 远程过程调用需要解决的问题

+ 函数指针不通用：建立callID映射

+ 不能通过内存传递参数，甚至双方语言不一样：序列化与反序列化协议

+ 如何跨进程传递：制定基于http，tcp，udp的传输协议

##### rpc流程

+ 服务消费方(client)调用以本地调用方式调用服务

+ client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体

+ client stub找到服务地址，并将消息发送到服务端

+ server stub收到消息后进行解码

+ server stub根据解码结果调用本地的服务

+ 本地服务执行并将结果返回给server stub

+ server stub将返回结果打包成消息并发送至消费方

+ client stub接收到消息，并进行解码

+ 服务消费方得到最终结果

2-8是一个rpc框架应该去封装的，使得rpc和本地函数调用一样简单


#### Rpc框架：Thrift

##### IDL代码生成

thrift编译器读取idl文件生成对应语言的文件

##### 序列化

文本协议与二进制协议

+ Binary

+ Json

##### 通讯协议

+ 其实上面的Binary既包含了序列化的实现，也包含了通讯协议的实现





## 网关
